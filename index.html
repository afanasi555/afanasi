<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê—Ñ–∞–Ω–∞—Å—å–µ–≤ –∑–∞–∏–≥—Ä—ã—à</title>
    <style>
        .game-board {
            display: grid;
            grid-template-columns: repeat(8, 50px);
            grid-gap: 2px;
        }
        .cell {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ccc;
            font-size: 24px;
            cursor: pointer;
        }
        .shop, .inventory, .stats {
            display: none;
            position: absolute;
            top: 50px;
            right: 20px;
            width: 200px;
            padding: 10px;
            background: #fff;
            border: 1px solid #ccc;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
        .shop .close, .inventory .close, .stats .close {
            float: right;
            cursor: pointer;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <h1>–ê—Ñ–∞–Ω–∞—Å—å–µ–≤ –∑–∞–∏–≥—Ä—ã—à</h1>
    <button onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    <button onclick="pauseGame()">–ü–∞—É–∑–∞</button>
    <button onclick="resetGame()">–°–±—Ä–æ—Å</button>
    <button onclick="undoMove()">–û—Ç–º–µ–Ω–∏—Ç—å —Ö–æ–¥</button>
    <button onclick="openShop()">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</button>
    <button onclick="openInventory()">üì¶ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
    <button onclick="openStats()">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>

    <div class="game-board"></div>

    <div class="shop">
        <span class="close" onclick="closeShop()">‚úñ</span>
        <h3>–ú–∞–≥–∞–∑–∏–Ω</h3>
        <button onclick="buyBomb()">–ö—É–ø–∏—Ç—å –±–æ–º–±—É (40 –º–æ–Ω–µ—Ç)</button>
        <button onclick="buyMove()">–ö—É–ø–∏—Ç—å —Ö–æ–¥ (1 –º–æ–Ω–µ—Ç–∞)</button>
        <p id="coins">–ú–æ–Ω–µ—Ç—ã: 0</p>
    </div>

    <div class="inventory">
        <span class="close" onclick="closeInventory()">‚úñ</span>
        <h3>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
        <p id="inventory-content"></p>
    </div>

    <div class="stats">
        <span class="close" onclick="closeStats()">‚úñ</span>
        <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        <p id="stats-content"></p>
    </div>

    <div id="task-list"></div>
    <p id="moves">–•–æ–¥–æ–≤: 0</p>

    <script>
        let moves = 20;
        let coins = 0;
        let currentLevel = 1;
        let tasks = [{ emoji: "üçì", count: 3 }];
        let selectedCell = null;
        let inventory = [];

        function startGame() {
            alert('–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!');
            generateBoard();
            updateMoves();
        }

        function pauseGame() {
            alert('–ò–≥—Ä–∞ –Ω–∞ –ø–∞—É–∑–µ.');
        }

        function resetGame() {
            alert('–ò–≥—Ä–∞ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∞!');
            generateBoard();
            updateMoves();
        }

        function undoMove() {
            alert('–•–æ–¥ –æ—Ç–º–µ–Ω–µ–Ω.');
        }

        function openShop() {
            document.querySelector('.shop').style.display = 'block';
        }

        function closeShop() {
            document.querySelector('.shop').style.display = 'none';
        }

        function openInventory() {
            document.querySelector('.inventory').style.display = 'block';
            updateInventory();
        }

        function closeInventory() {
            document.querySelector('.inventory').style.display = 'none';
        }

        function openStats() {
            let statsString = "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–æ–≤:\n";
            document.getElementById('stats-content').textContent = statsString;
            document.querySelector('.stats').style.display = 'block';
        }

        function closeStats() {
            document.querySelector('.stats').style.display = 'none';
        }

        function selectLevel(level) {
            if (level > currentLevel) {
                alert('–≠—Ç–æ—Ç —É—Ä–æ–≤–µ–Ω—å –ø–æ–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.');
                return;
            }
            currentLevel = level;
            alert(`–í—ã –≤—ã–±—Ä–∞–ª–∏ —É—Ä–æ–≤–µ–Ω—å ${level}`);
            loadLevel(level);
        }

        function loadLevel(level) {
            moves = 20 + level * 5;
            tasks = generateTasksForLevel(level);
            updateTaskList();
            generateBoard();
            updateMoves();
        }

        function generateTasksForLevel(level) {
            let taskList = [];
            if (level >= 5) {
                taskList.push({ emoji: "üçì", count: 5 });
                taskList.push({ emoji: "üçí", count: 4 });
            } else {
                taskList.push({ emoji: "üçì", count: 3 + level });
            }
            return taskList;
        }

        function updateTaskList() {
            let taskListDiv = document.getElementById("task-list");
            taskListDiv.innerHTML = "";
            tasks.forEach((task, index) => {
                taskListDiv.innerHTML += `<p class="task-item">–ó–∞–¥–∞—á–∞ ${index + 1}: –°–æ–±—Ä–∞—Ç—å ${task.count} ${task.emoji}</p>`;
            });
        }

        function generateBoard() {
            let board = document.querySelector('.game-board');
            board.innerHTML = "";
            for (let i = 0; i < 64; i++) {
                let cell = document.createElement('div');
                cell.className = 'cell';
                cell.textContent = getRandomEmoji();
                cell.addEventListener('click', () => selectCell(cell, i));
                board.appendChild(cell);
            }
            setTimeout(() => {
                checkMatches();
                refillBoard();
            }, 500);
        }

        function getRandomEmoji() {
            const emojis = ["‚≠ê", "‚ú®", "üí¶", "üî•", "üéâ", "‚ù§Ô∏è", "üçì", "üçí", "üçâ", "üçï", "üê±", "üêØ"];
            return emojis[Math.floor(Math.random() * emojis.length)];
        }

        function selectCell(cell, index) {
            if (selectedCell === null) {
                selectedCell = { element: cell, index: index };
                cell.style.border = '2px solid red';
            } else {
                if (isAdjacent(selectedCell.index, index)) {
                    swapCells(selectedCell.element, cell);
                    moves--;
                    updateMoves();
                    setTimeout(() => {
                        checkMatches();
                        refillBoard();
                    }, 500);
                }
                selectedCell.element.style.border = '1px solid #ccc';
                selectedCell = null;
            }
        }

        function isAdjacent(index1, index2) {
            const row1 = Math.floor(index1 / 8);
            const col1 = index1 % 8;
            const row2 = Math.floor(index2 / 8);
            const col2 = index2 % 8;
            return (Math.abs(row1 - row2) + Math.abs(col1 - col2)) === 1;
        }

        function swapCells(cell1, cell2) {
            const temp = cell1.textContent;
            cell1.textContent = cell2.textContent;
            cell2.textContent = temp;
        }

        function checkMatches() {
            let board = document.querySelectorAll('.cell');
            let matchedCells = [];
            for (let i = 0; i < 64; i++) {
                const row = Math.floor(i / 8);
                if (i % 8 <= 5 &&
                    board[i].textContent === board[i + 1].textContent &&
                    board[i].textContent === board[i + 2].textContent &&
                    board[i].textContent === board[i + 3].textContent) {
                    matchedCells.push(i, i + 1, i + 2, i + 3);
                }
                if (row <= 4 &&
                    board[i].textContent === board[i + 8].textContent &&
                    board[i].textContent === board[i + 16].textContent &&
                    board[i].textContent === board[i + 24].textContent) {
                    matchedCells.push(i, i + 8, i + 16, i + 24);
                }
            }

            if (matchedCells.length > 0) {
                matchedCells = [...new Set(matchedCells)];
                matchedCells.forEach(index => {
                    board[index].textContent = "";
                });
                setTimeout(() => {
                    refillBoard();
                    checkMatches();
                }, 500);
                checkTasks();
            }
        }

        function createBomb(index) {
            let board = document.querySelectorAll('.cell');
            board[index].textContent = "üí£";
        }

        function refillBoard() {
            let board = document.querySelectorAll('.cell');
            for (let i = 0; i < board.length; i++) {
                if (board[i].textContent === "") {
                    board[i].textContent = getRandomEmoji();
                }
            }
        }

        function checkTasks() {
            tasks.forEach(task => {
                let count = 0;
                document.querySelectorAll('.cell').forEach(cell => {
                    if (cell.textContent === task.emoji) {
                        count++;
                    }
                });
                task.count -= count;
                if (task.count <= 0) {
                    alert('–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!');
                    tasks = tasks.filter(t => t !== task);
                    updateTaskList();
                }
            });
        }

        function buyBomb() {
            if (coins >= 40) {
                coins -= 40;
                inventory.push('üí£');
                alert('–ë–æ–º–±–∞ –∫—É–ø–ª–µ–Ω–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å!');
                updateInventory();
            } else {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.');
            }
            updateCoins();
        }

        function buyMove() {
            if (coins >= 1) {
                coins -= 1;
                moves += 1;
                updateMoves();
            } else {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.');
            }
        }

        function updateCoins() {
            document.getElementById("coins").textContent = `–ú–æ–Ω–µ—Ç—ã: ${coins}`;
        }

        function updateMoves() {
            document.getElementById("moves").textContent = `–•–æ–¥–æ–≤: ${moves}`;
        }

        function updateInventory() {
            document.getElementById('inventory-content').textContent = inventory.join(', ');
        }

        window.onload = function() {
            startGame();
        };
    </script>
</body>
</html>
