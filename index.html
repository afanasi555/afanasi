<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match 3 Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
        }

        #menu {
            margin: 20px;
        }

        #game {
            display: none;
            flex-direction: column;
            align-items: center;
        }

        #board {
            display: grid;
            grid-template-columns: repeat(8, 50px);
            grid-template-rows: repeat(8, 50px);
            gap: 5px;
            margin-bottom: 20px;
        }

        .cell {
            width: 50px;
            height: 50px;
            background-color: #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
        }

        .selected {
            border: 2px solid #000;
        }

        #controls {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }

        #taskDisplay, #levelDisplay, #movesLeftDisplay {
            margin-bottom: 10px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div id="menu">
        <button id="startGame">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        <button id="shopButton">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</button>
    </div>
    <div id="game">
        <div id="levelDisplay">–£—Ä–æ–≤–µ–Ω—å: <span id="currentLevel">1</span></div>
        <div id="taskDisplay">–ó–∞–¥–∞–Ω–∏–µ: <span id="task"></span></div>
        <div id="movesLeftDisplay">–û—Å—Ç–∞–ª–æ—Å—å —Ö–æ–¥–æ–≤: <span id="movesLeft"></span></div>
        <div id="board"></div>
        <div id="controls">
            <button id="restartButton">üîÉ –ó–∞–Ω–æ–≤–æ</button>
            <button id="pauseButton">–ü–∞—É–∑–∞</button>
            <button id="undoButton">–û—Ç–º–µ–Ω–∏—Ç—å —Ö–æ–¥</button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const emojis = ['‚≠ê', '‚ú®', 'üí¶', 'üî•', 'üéâ', '‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'ü©µ', 'üíô', 'üíú', 'ü§é', 'üñ§', 'ü©∂', 'üíÖ', 'üåπ', 'üå∏', 'üå±', 'üå≥', 'üçÄ', 'üå≤', '‚õÑ', '‚òÉÔ∏è', 'üåù', 'üåö', 'üåï', 'üê±', 'üêØ', 'ü¶Å', 'ü¶Ñ', 'üê∏', 'üêò', 'üê£', 'üêü', 'üê†', 'üê°', 'ü™º', 'üêû', 'üêù', 'üçì', 'üçí', 'üçé', 'üçâ', 'üçå', 'üçç', 'üçá', 'üçî', 'ü•®', 'üçü', 'üçï', 'ü•ó', 'üç≠', 'üç¨', 'üç´', 'üç™', 'üçØ', 'ü•§', 'üéÄ', 'üéÅ', 'üéà', 'üéä', 'üéâ', 'üß®', '‚öΩ', 'üèÄ', 'üß∂', 'üìÄ', 'üíø', 'üí∏', 'üë†', '‚öúÔ∏è', 'üî±', '‚ò¢Ô∏è', '‚ò£Ô∏è'];
            const bombEmoji = 'üí£';
            const explosionEmoji = 'üí•';
            let currentLevel = 1;
            let board = [];
            let selectedCell = null;
            let task = {};
            let movesLeft = 30;
            let previousBoard = [];

            // –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const startGameButton = document.getElementById('startGame');
            const restartButton = document.getElementById('restartButton');
            const undoButton = document.getElementById('undoButton');
            const shopButton = document.getElementById('shopButton');
            const gameContainer = document.getElementById('game');
            const menuContainer = document.getElementById('menu');
            const boardElement = document.getElementById('board');
            const taskDisplay = document.getElementById('task');
            const levelDisplay = document.getElementById('currentLevel');
            const movesLeftDisplay = document.getElementById('movesLeft');

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
            startGameButton.addEventListener('click', startGame);
            restartButton.addEventListener('click', restartLevel);
            undoButton.addEventListener('click', undoMove);

            // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã
            function startGame() {
                menuContainer.style.display = 'none';
                gameContainer.style.display = 'flex';
                loadLevel(currentLevel);
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–≤–Ω—è
            function loadLevel(level) {
                generateBoard();
                updateTask();
                renderBoard();
                levelDisplay.textContent = level;
                movesLeftDisplay.textContent = movesLeft;
            }

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Å–∫–∏
            function generateBoard() {
                board = Array(8).fill(null).map(() => Array(8).fill(null).map(() => generateEmoji()));
                previousBoard = JSON.parse(JSON.stringify(board)); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ—Ç–º–µ–Ω—ã —Ö–æ–¥–∞
            }

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–º–∞–π–ª–∏–∫–∞
            function generateEmoji() {
                return emojis[Math.floor(Math.random() * emojis.length)];
            }

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å–∫–∏
            function renderBoard() {
                boardElement.innerHTML = '';
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const cell = document.createElement('div');
                        cell.classList.add('cell');
                        cell.dataset.row = row;
                        cell.dataset.col = col;
                        cell.textContent = board[row][col];
                        cell.addEventListener('click', handleCellClick);
                        boardElement.appendChild(cell);
                    }
                }
            }

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —è—á–µ–π–∫–µ
            function handleCellClick(event) {
                const row = parseInt(event.target.dataset.row);
                const col = parseInt(event.target.dataset.col);

                if (selectedCell) {
                    const prevRow = parseInt(selectedCell.dataset.row);
                    const prevCol = parseInt(selectedCell.dataset.col);

                    if (isAdjacent(prevRow, prevCol, row, col)) {
                        makeMove(prevRow, prevCol, row, col);
                        checkMatches();
                        movesLeft--;
                        movesLeftDisplay.textContent = movesLeft;
                        if (movesLeft <= 0) {
                            alert('–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–Ω–æ–≤–æ.');
                            restartLevel();
                        }
                    }

                    selectedCell.classList.remove('selected');
                    selectedCell = null;
                } else {
                    selectedCell = event.target;
                    selectedCell.classList.add('selected');
                }
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è—é—Ç—Å—è –ª–∏ —è—á–µ–π–∫–∏ —Å–æ—Å–µ–¥–Ω–∏–º–∏
            function isAdjacent(row1, col1, row2, col2) {
                return (Math.abs(row1 - row2) === 1 && col1 === col2) ||
                       (Math.abs(col1 - col2) === 1 && row1 === row2);
            }

            // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ö–æ–¥–∞
            function makeMove(fromRow, fromCol, toRow, toCol) {
                previousBoard = JSON.parse(JSON.stringify(board)); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ—Ç–º–µ–Ω—ã —Ö–æ–¥–∞

                // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
                const temp = board[fromRow][fromCol];
                board[fromRow][fromCol] = board[toRow][toCol];
                board[toRow][toCol] = temp;

                // –ü–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å–∫—É
                renderBoard();
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π (3 –∏ –±–æ–ª–µ–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö)
            function checkMatches() {
                let matched = false;
                const toRemove = [];

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 6; col++) {
                        const cell = board[row][col];
                        if (cell && cell === board[row][col + 1] && cell === board[row][col + 2]) {
                            toRemove.push({row, col});
                            toRemove.push({row, col: col + 1});
                            toRemove.push({row, col: col + 2});
                            matched = true;
                        }
                    }
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
                for (let col = 0; col < 8; col++) {
                    for (let row = 0; row < 6; row++) {
                        const cell = board[row][col];
                        if (cell && cell === board[row + 1][col] && cell === board[row + 2][col]) {
                            toRemove.push({row, col});
                            toRemove.push({row: row + 1, col});
                            toRemove.push({row: row + 2, col});
                            matched = true;
                        }
                    }
                }

                if (matched) {
                    // –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–≤–ø–∞–¥–∞—é—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
                    toRemove.forEach(({row, col}) => {
                        board[row][col] = null;
                    });

                    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –º–µ—Å—Ç
                    fillBoard();
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    checkMatches();
                }
            }

            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –º–µ—Å—Ç –Ω–æ–≤—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
            function fillBoard() {
                for (let col = 0; col < 8; col++) {
                    let emptySpaces = [];
                    for (let row = 7; row >= 0; row--) {
                        if (board[row][col] === null) {
                            emptySpaces.push(row);
                        } else if (emptySpaces.length > 0) {
                            const emptyRow = emptySpaces.pop();
                            board[emptyRow][col] = board[row][col];
                            board[row][col] = null;
                            emptySpaces.push(row);
                        }
                    }

                    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
                    emptySpaces.forEach(row => {
                        board[row][col] = generateEmoji();
                    });
                }
            }

            // –û—Ç–º–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ö–æ–¥–∞
            function undoMove() {
                if (previousBoard.length) {
                    board = JSON.parse(JSON.stringify(previousBoard));
                    renderBoard();
                    movesLeft++;
                    movesLeftDisplay.textContent = movesLeft;
                }
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
            function updateTask() {
                task = {
                    type: 'collect',
                    target: emojis[Math.floor(Math.random() * emojis.length)],
                    amount: 10 + currentLevel
                };
                taskDisplay.textContent = `–°–æ–±–µ—Ä–∏—Ç–µ ${task.amount} ${task.target}`;
            }

            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–≤–Ω—è
            function restartLevel() {
                movesLeft = 30;
                loadLevel(currentLevel);
            }
        });
    </script>
</body>
</html>
