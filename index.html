<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Три в ряд - Многоуровневая игра</title>
    <style>
        /* Основные стили */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .menu, .level-board, .game-board, .shop {
            margin-top: 20px;
            display: none;
        }
        .menu {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .menu h1, .game-board h1 {
            font-size: 32px;
        }
        .levels {
            display: grid;
            grid-template-columns: repeat(5, 50px);
            gap: 10px;
            margin-top: 20px;
        }
        .level {
            width: 50px;
            height: 50px;
            background-color: #fff;
            border: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            cursor: pointer;
        }
        .locked {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .shop-button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #008CBA;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .game-board {
            display: grid;
            grid-template-columns: repeat(8, 50px);
            gap: 5px;
            margin-top: 20px;
        }
        .cell {
            width: 50px;
            height: 50px;
            background-color: #fff;
            border: 1px solid #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
        }
        .status {
            margin-top: 10px;
            font-size: 18px;
        }
        .shop, .shop-button {
            display: block;
        }
        .shop {
            background-color: #fff;
            padding: 20px;
            border: 1px solid #ccc;
            text-align: center;
        }
        .shop button {
            margin: 5px;
            padding: 10px 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="menu">
        <h1>Выберите уровень</h1>
        <div class="levels" id="levels">
            <!-- Уровни будут генерироваться динамически -->
        </div>
        <button class="shop-button" onclick="openShop()">🛍️ Магазин</button>
    </div>

    <div class="game-board" id="game-board">
        <h1>Игра</h1>
        <div class="status">
            <p>Осталось ходов: <span id="moves-left"></span></p>
            <p>Задание: Собрать <span id="task-item"></span> x <span id="task-count"></span></p>
        </div>
        <div id="board" class="game-board">
            <!-- Игровое поле будет генерироваться динамически -->
        </div>
        <button class="shop-button" onclick="retryLevel()">🔃 Пройти заново</button>
    </div>

    <div class="shop" id="shop">
        <h2>🛍️ Магазин</h2>
        <p>Ваши монеты: <span id="coins">0</span> 🌕</p>
        <button onclick="buyItem('bomb')">Купить Бомбу 💣 - 40 монет</button>
        <button onclick="buyItem('move')">Купить ход ➕ - 1 монета</button>
        <button onclick="closeShop()">Закрыть магазин</button>
    </div>

    <script>
        // Смайлики для игрового поля
        const objects = [
            '⭐', '✨', '💦', '🔥', '🎉', '❤️', '🧡', '💛', '💚', '🩵', '💙', 
            '💜', '🤎', '🖤', '🩶', '💅', '🌹', '🌸', '🌱', '🌳', '🍀', '🌲', 
            '⛄', '☃️', '🌝', '🌚', '🌕', '🐱', '🐯', '🦁', '🦄', '🐸', '🐘', 
            '🐣', '🐟', '🐠', '🐡', '🪼', '🐞', '🐝', '🍓', '🍒', '🍎', '🍉', 
            '🍌', '🍍', '🍇', '🍔', '🥨', '🍟', '🍕', '🥗', '🍭', '🍬', '🍫', 
            '🍪', '🍯', '🥤', '🎀', '🎁', '🎈', '🎊', '🎉', '🧨', '⚽', '🏀', 
            '🧶', '📀', '💿', '💸', '👠', '⚜️', '🔱', '☢️', '☣️', '💣'  // Бомба 💣
        ];

        let levels = [];
        let coins = 0;
        let currentLevelIndex = 0;
        let movesLeft = 0;
        let taskCount = 0;
        let board = [];

        function generateLevels() {
            for (let i = 1; i <= 10; i++) {
                const randomItem = objects[Math.floor(Math.random() * objects.length)];
                const randomCount = Math.floor(Math.random() * 6) + 3;  // Задача на сбор от 3 до 8 предметов
                const maxMoves = randomCount * 2 + 5;  // Количество ходов зависит от сложности задачи
                levels.push({
                    level: i,
                    task: { item: randomItem, count: randomCount },
                    maxMoves: maxMoves,
                    completed: false,
                    stars: 0
                });
            }
        }

        function initializeMenu() {
            const levelsElement = document.getElementById('levels');
            levelsElement.innerHTML = '';
            levels.forEach((level, index) => {
                const levelElement = document.createElement('div');
                levelElement.className = 'level';
                if (level.completed || index === 0 || levels[index - 1].completed) {
                    levelElement.textContent = `${level.level} 🌟${level.stars}`;
                    levelElement.addEventListener('click', () => startLevel(index));
                } else {
                    levelElement.textContent = `${level.level}`;
                    levelElement.className += ' locked';
                }
                levelsElement.appendChild(levelElement);
            });
        }

        function startLevel(index) {
            currentLevelIndex = index;
            movesLeft = levels[index].maxMoves;
            taskCount = levels[index].task.count;
            document.getElementById('moves-left').textContent = movesLeft;
            document.getElementById('task-item').textContent = levels[index].task.item;
            document.getElementById('task-count').textContent = taskCount;

            board = generateBoard(8);
            renderBoard();

            document.querySelector('.menu').style.display = 'none';
            document.querySelector('.game-board').style.display = 'block';
        }

        function generateBoard(size) {
            const board = [];

            for (let i = 0; i < size; i++) {
                const row = [];

                for (let j = 0; j < size; j++) {
                    let newItem = objects[Math.floor(Math.random() * objects.length)];

                    // Проверка, чтобы не было совпадений сразу при генерации
                    if (j >= 2 && row[j - 1] === row[j - 2] && row[j - 1] === newItem) {
                        // Если предыдущие два элемента одинаковы, выбираем другой элемент
                        newItem = objects.filter(item => item !== row[j - 1])[Math.floor(Math.random() * (objects.length - 1))];
                    } else if (i >= 2 && board[i - 1][j] === board[i - 2][j] && board[i - 1][j] === newItem) {
                        // Если два элемента по вертикали одинаковы, выбираем другой элемент
                        newItem = objects.filter(item => item !== board[i - 1][j])[Math.floor(Math.length - 1))];
                    }

                    row.push(newItem);
                }

                board.push(row);
            }

            // Добавляем комбинации 2 или 3 объектов рядом
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size - 2; j++) {
                    if (Math.random() < 0.3) {  // 30% шанс на создание комбинации
                        let patternType = Math.random();
                        
                        if (patternType < 0.5) {  // 50% шанс на пару объектов
                            board[i][j] = board[i][j + 1] = objects[Math.floor(Math.random() * objects.length)];
                        } else {  // 50% шанс на 3 объекта, с одним объектом между ними
                            board[i][j] = board[i][j + 2] = objects[Math.floor(Math.random() * objects.length)];
                        }
                    }
                }
            }

            return board;
        }

        function renderBoard() {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';

            board.forEach(row => {
                row.forEach(cell => {
                    const cellElement = document.createElement('div');
                    cellElement.className = 'cell';
                    cellElement.textContent = cell;
                    cellElement.onclick = () => handleCellClick(cell);
                    boardElement.appendChild(cellElement);
                });
            });
        }

        function handleCellClick(cell) {
            // Логика для обработки нажатия на ячейку
            // Эта функция может быть расширена для обработки перемещения и проверки совпадений
            console.log('Cell clicked:', cell);
        }

        function retryLevel() {
            startLevel(currentLevelIndex);
        }

        function openShop() {
            document.querySelector('.menu').style.display = 'none';
            document.querySelector('.game-board').style.display = 'none';
            document.querySelector('.shop').style.display = 'block';
        }

        function closeShop() {
            document.querySelector('.shop').style.display = 'none';
            document.querySelector('.menu').style.display = 'block';
        }

        function buyItem(item) {
            if (item === 'bomb') {
                if (coins >= 40) {
                    coins -= 40;
                    document.getElementById('coins').textContent = coins;
                    // Логика для покупки бомбы
                    console.log('Bought bomb');
                } else {
                    alert('Не хватает монет!');
                }
            } else if (item === 'move') {
                if (coins >= 1) {
                    coins -= 1;
                    document.getElementById('coins').textContent = coins;
                    movesLeft += 1;
                    document.getElementById('moves-left').textContent = movesLeft;
                    // Логика для добавления хода
                    console.log('Bought move');
                } else {
                    alert('Не хватает монет!');
                }
            }
        }

        // Инициализация игры и меню
        generateLevels();
        initializeMenu();
    </script>

</body>
</html>
